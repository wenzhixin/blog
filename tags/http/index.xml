<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Http on 文翼的博客</title>
    <link>http://blog.wenzhixin.net.cn/tags/http/</link>
    <description>Recent content in Http on 文翼的博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <copyright>wenzhixin.net.cn 粤ICP备15117953号</copyright>
    <lastBuildDate>Sat, 19 Oct 2013 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://blog.wenzhixin.net.cn/tags/http/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>nginx 开启 http 下载服务器认证</title>
      <link>http://blog.wenzhixin.net.cn/2013/10/19/nginx_http_auth</link>
      <pubDate>Sat, 19 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>http://blog.wenzhixin.net.cn/2013/10/19/nginx_http_auth</guid>
      <description>

&lt;h4 id=&#34;1-介绍:5697f69a7ab129c553754cdfa6ec4167&#34;&gt;1. 介绍&lt;/h4&gt;

&lt;p&gt;有时候，我们需要提供下载服务器给别人文件，但是又不想给所有人看到，从而保证安全性。
这种时候，对目录访问进行认证，并且每天改变随机密码，共享的时候提供地址、用户名和密码就可以了。&lt;/p&gt;

&lt;h4 id=&#34;2-nginx-设置:5697f69a7ab129c553754cdfa6ec4167&#34;&gt;2. nginx 设置&lt;/h4&gt;

&lt;p&gt;1) 设置 nginx 的配置文件（/etc/nginx/sites-enabled/default）：&lt;/p&gt;
location /download/ {
    # 下载目录为 /home/myname/download
    root /home/myname;

    # 设置目录浏览
    autoindex on;

    # 默认为on，显示出文件的确切大小，单位是bytes。
    # 改为off后，显示出文件的大概大小，单位是kB或者MB或者GB
    autoindex_exact_size off;

    # 默认为off，显示的文件时间为GMT时间
    # 注意:改为on后，显示的文件时间为文件的服务器时间
    autoindex_localtime on;

    # 在第一次访问目录时，会弹出输入验证框
    auth_basic &#34;Restricted&#34;;

    # 存放密码的文件，/etc/nginx/passwd/download
    auth_basic_user_file passwd/download;

    # 设置charset，解决中文乱码问题
    charset utf-8,gbk;
}

&lt;p&gt;2) 生成密码文件：&lt;/p&gt;
sudo mkdir /etc/nginx/passwd
sudo chmod 777 /etc/nginx/passwd
sudo vi /etc/nginx/passwd/download
sudo chmod 777 /etc/nginx/passwd/download

&lt;p&gt;输入用户名和密码（密码会在第三步被替换）：&lt;/p&gt;
admin: admin

&lt;ul&gt;
&lt;li&gt;admin 为自己使用的用户名密码&lt;/li&gt;
&lt;li&gt;guest 提供给他人使用的用户名和密码&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;3) 设置 admin 的密码（apt-get install apache2-utils）：&lt;/p&gt;
sudo htpasswd /etc/nginx/passwd/download admin

&lt;p&gt;4) 重启 nginx 就可以了：&lt;/p&gt;
sudo service nginx restart

&lt;h4 id=&#34;3-每天随机生成-guest-密码:5697f69a7ab129c553754cdfa6ec4167&#34;&gt;3. 每天随机生成 guest 密码&lt;/h4&gt;

&lt;p&gt;1) 编写 shell 脚本（random_password.sh）：&lt;/p&gt;
#!/bin/bash

passwd=`cat /dev/urandom | head -1 | md5sum | head -c 6`
echo guest $passwd &gt; /home/myname/download/password.txt
htpasswd -b /etc/nginx/passwd/download guest $passwd

&lt;p&gt;2) 编辑 crontab：&lt;/p&gt;
crontab -e

&lt;p&gt;添加内容：&lt;/p&gt;
0 0 * * * random_password.sh

&lt;p&gt;3) 登录查看密码：&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://yourhost/download/password.txt&#34;&gt;http://yourhost/download/password.txt&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>