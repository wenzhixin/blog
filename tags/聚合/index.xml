<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>聚合 on 文翼的博客</title>
    <link>http://blog.wenzhixin.net.cn/tags/%E8%81%9A%E5%90%88/</link>
    <description>Recent content in 聚合 on 文翼的博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <copyright>wenzhixin.net.cn 粤ICP备15117953号</copyright>
    <atom:link href="http://blog.wenzhixin.net.cn/tags/%E8%81%9A%E5%90%88/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>简单的博客 RSS 聚合</title>
      <link>http://blog.wenzhixin.net.cn/1/01/01/simple_rss_together</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://blog.wenzhixin.net.cn/1/01/01/simple_rss_together</guid>
      <description>

&lt;h4 id=&#34;1-前言:620c4514ef1d6b73485351aca4a1e232&#34;&gt;1. 前言&lt;/h4&gt;

&lt;p&gt;将博客的 RSS 内容聚合起来，这样方便查看，今天就来研究如何简单的将 RSS 的内容存到数据库（MySQL）中。&lt;/p&gt;

&lt;h4 id=&#34;2-创建数据库表:620c4514ef1d6b73485351aca4a1e232&#34;&gt;2. 创建数据库表&lt;/h4&gt;
CREATE TABLE links (  
    id int NOT NULL AUTO_INCREMENT,  
    name varchar(250) NOT NULL,
    url varchar(250) NOT NULL,
    time timestamp NOT NULL DEFAULT current_timestamp,
    PRIMARY KEY (id),
    UNIQUE (url)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

&lt;p&gt;数据库表只有名称和链接地址两个字段，这里的 url 是唯一的，可以防止插入重复的数据。&lt;/p&gt;

&lt;h4 id=&#34;3-插入数据-insert-ignore:620c4514ef1d6b73485351aca4a1e232&#34;&gt;3. 插入数据 INSERT IGNORE&lt;/h4&gt;

&lt;p&gt;INSERT IGNORE INTO 与 INSERT INTO 的区别是：
INSERT IGNORE 会忽略数据库中已经存在的数据。
如果数据库没有数据，就插入新的数据，
如果有数据的话就跳过这条数据。&lt;/p&gt;

&lt;p&gt;例如我们连续插入数据：&lt;/p&gt;
INSERT IGNORE INTO links(name, url) values(&#39;wenyi&#39;, &#39;http://wenzhixin.net.cn&#39;);

&lt;p&gt;第一条是：&lt;/p&gt;
Query OK, 1 row affected

&lt;p&gt;其他的都是：&lt;/p&gt;
Query OK, 0 rows affected

&lt;p&gt;查看数据库，也是只有一条记录。&lt;/p&gt;

&lt;h4 id=&#34;4-编写代码:620c4514ef1d6b73485351aca4a1e232&#34;&gt;4. 编写代码&lt;/h4&gt;

&lt;p&gt;使用 nodejs 来编写代码，主要涉及的是对 RSS 订阅源的解析以及将解析出来的文件写进数据库中。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;RSS 解析模块使用 &lt;a href=&#34;https://github.com/danmactough/node-feedparser&#34;&gt;node-feedparser&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;MySQL 模块使用 &lt;a href=&#34;https://github.com/felixge/node-mysql&#34;&gt;node-mysql&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;5-注意的地方:620c4514ef1d6b73485351aca4a1e232&#34;&gt;5. 注意的地方&lt;/h4&gt;

&lt;p&gt;默认情况下，使用 INSERT IGNORE 之后，即使在没有插入数据的情况下，自增长的主键也会变化，这并不是我们想要的。&lt;/p&gt;

&lt;p&gt;可以通过设置 &lt;a href=&#34;http://dev.mysql.com/doc/refman/5.1/en/innodb-auto-increment-handling.html#innodb-auto-increment-configurable&#34;&gt;innodb auto increment configurable&lt;/a&gt;，避免这种情况。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;需要将数据库表的 ENGINE 设置为 InnoDB（ENGINE=InnoDB）&lt;/li&gt;
&lt;li&gt;需要在 MySQL 的配置文件中添加 innodb_autoinc_lock_mode = 0&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;具体设置方法（Ubuntu 下）：&lt;/p&gt;
sudo vi /etc/mysql/my.cnf

&lt;p&gt;在 [mysqld] 下增加：&lt;/p&gt;
innodb_autoinc_lock_mode = 0
</description>
    </item>
    
  </channel>
</rss>